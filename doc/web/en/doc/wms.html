<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">

  <title>Suika2 | How to script with WMS</title>
  <meta name="Description" content="This page describes how to script with WMS on Suika2.">
  <meta name="theme-color" content="#eb8334">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/adjustments.css">
  <script src="/js/bootstrap.bundle.min.js"></script>

	<!-- INSERT-GTAG-HERE -->
</head>
<body>

<!-- BEGIN-EN-HEADER -->
<nav class="navbar navbar-expand-lg bg-dark nav-block" data-bs-theme="dark">
	<div class="container">
		<a class="navbar-brand d-none d-md-block" href="/en/"><img height="100" src="/img/icons/suika.png" alt="suika2"></a>
		<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" aria-current="page" href="/en/">Home</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="/en/dl/">Downloads</a></li>
				<li class="nav-item dropdown" aria-current="page">
					<a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
						Document
					</a>
					<ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink">
						<li><a class="dropdown-item" href="/en/doc/">Index</a></li>
						<li><a class="dropdown-item" href="/en/doc/tutorial.html">Tutorial</a></li>
						<li><a class="dropdown-item" href="/en/doc/reference.html">Command Reference</a></li>
						<li><a class="dropdown-item" href="/en/doc/title.html">Title Creation</a></li>
						<li><a class="dropdown-item" href="/en/doc/font.html">Font Change</a></li>
						<li><a class="dropdown-item" href="/en/doc/wms.html">WMS Usage</a></li>
						<li><a class="dropdown-item" href="/en/doc/faq.html">FAQ</a></li>
					</ul>
				</li>
        <li class="nav-item"><a class="nav-link" href="/en/wiki/">Wiki</a></li>
        <li class="nav-item"><a class="nav-link" href="/en/works/">Works</a></li>
        <li class="nav-item"><a class="nav-link" href="/">Japanese</a></li>
        <li class="nav-item dropdown d-block d-md-none">
          <a class="btn btn-outline-success rounded-0 dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-moon"></i></a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
            <li><button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">Light</button></li>
            <li><button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">Dark</button></li>
            <li><button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="true">Auto</button></li>
          </ul>
        </li>
      </ul>
      <li class="nav-item dropdown d-none d-md-block">
        <a class="btn btn-outline-success rounded-0 dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-moon"></i></a>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
          <li><button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">Light</button></li>
          <li><button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">Dark</button></li>
          <li><button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="true">Auto</button></li>
        </ul>
      </li>
		</div>
	</div>
</nav>
<!-- END-EN-HEADER -->

<!-- Title Strip-->
<div class="block">
	<div class="container">
		<div class="row">
			<div class="col-md">
				<h1>WMSの使い方 (Under translation)</h1>
				<p>Suika2のWMSのマニュアルです。</p>
			</div>
		</div>
	</div>
</div>

<!-- BEGIN-CONTENT -->
<div class="container">
	<div class="row">
		<div class="col-xs-12 col-sm-12 col-md-12">
<!-- -------------- -->

<h2>WMSとは</h2>
<p>
	Suika2を拡張するための独自言語です。
	プログラマでなくても使えるように、かんたんな言語仕様にしてあります。
</p>

<h2>基本の使い方</h2>
<p>
	例えば文字の色は <code>conf/config.txt</code> の中で次のように指定されていますよね。
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>font.color.r=255
font.color.g=255
font.color.b=255
</code></pre></div>
<!-- END-CODE -->

<p>
	WMSを使うと、これをゲーム中に変更することができます。<br>
	次のスクリプトを <code>wms/change-color.txt</code> として保存してください。
</p>

<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>func main() {
    s2_set_config("font.color.r", "128");
    s2_set_config("font.color.g", "128");
    s2_set_config("font.color.b", "128");
}</code></pre></div>
<!-- END-CODE -->

<p>
	そして、<code>init.txt</code> の中で次のように呼び出してみてください。
</p>

<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>今から文字の色が変わります。
@wms change-color.txt
文字の色が変わりました。</code></pre></div>
<!-- END-CODE -->

<p>
	使い方の基本はこれだけです。<br>
	今後はエフェクトなどのプラグイン制作も可能にしていきますが、現時点ではコンフィグの書き換えがメインの用途です。
</p>

<h2>文法</h2>
<p>
	汎用的なプログラミングが行えます。ここでは文法について説明します。<br>
	プログラミングが苦手な方は、あえて読む必要はないと思います。
</p>

<h3>プログラムは <code>main()</code> 関数から始まる</h3>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>func main() {
    // これはコメントです
    print("Hello, world!");
}</code></pre></div>
<!-- END-CODE -->

<h3>関数は他の関数を呼び出しできる</h3>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>func main() {
    foo(0, 1, 2);
}

func foo(a, b, c) {
    return a + b + c;
}</code></pre></div>
<!-- END-CODE -->

<h3>文字列変数による間接呼び出しが可能</h3>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>func main() {
    myfunc = "foo";
    myfunc(0, 1, 2);
}

func foo(a, b, c) {
    return a + b + c;
}

func myfunc(a, b, c) {
    // この関数は呼び出されません。foo()が呼び出されます。
}</code></pre></div>
<!-- END-CODE -->

<h3>型と変数</h3>
<p>
	プログラムは整数、浮動小数点数、文字列、配列の変数と値を利用できます。
</p>

<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>func main() {
    // 整数
    a = 1;
    if(isint(a)) {
        print("a is int");
    }

    // 浮動小数点数
    b = 1.0;
    if(isfloat(b)) {
        print("b is float");
    }

    // 文字列
    c = "string";
    if(isstr(c)) {
        print("c is string");
    }

    // 配列 (整数インデックス)
    d[0] = 0;
    if(isarray(d)) {
        print("d is array");
    }

    // 配列 (文字列インデックス)
    e["abc"] = 0;
    if(isarray(e)) {
        print("e is array");
    }

    // 配列の配列
    f["key"] = e;
}</code></pre></div>

<h3>ループ</h3>
<p>指定した回数の繰り返し:</p>
<div class="code-block"><pre><code>func main() {
    for(i in 0..9) {
        print(i);
    }
}</code></pre></div>
<!-- END-CODE -->

<p>
	配列の値についての繰り返し:
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>func main() {
    a[0] = 0;
    a[1] = 1;
    a[2] = 2;

    for(v in a) {
        print(v);
    }
}</code></pre></div>
<!-- END-CODE -->

<p>
	配列のキー/値ペアについての繰り返し:
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>func main() {
    a["key1"] = 0;
    a["key2"] = 1;
    a["key3"] = 2;

    for(k, v in a) {
        print(k + "=" + v);
    }
}</code></pre></div>
<!-- END-CODE -->

<p>
	単純な <code>while</code> ループ:
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>func main() {
    a = 10;
    while (a > 0) {
        print(a);
        a = a - 1;
    }
}</code></pre></div>
<!-- END-CODE -->

<p>
	<code>break</code> と <code>continue</code>:
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>func main() {
    for(i in 0..9) {
        if(i == 2) {
            continue;
        }
        if(i == 7) {
            break;
        }
    }
}</code></pre></div>
<!-- END-CODE -->

<h3>分岐</h3>
<p>
	プログラムは <code>if</code> - <code>else if</code> - <code>else</code> で分岐できます。
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>func main() {
    a = foo();
    if(a > 10) {
        print("a > 10");
    } else if(a > 5) {
        print("a > 5");
    } else {
        print("else");
    }
}

func foo() {
    return 6;
}</code></pre></div>
<!-- END-CODE -->

<h3>配列</h3>
<p>
	配列の要素はキー(インデックス)を持ち、キーには整数、浮動小数点数、文字列が使えます。<br>
	１つの配列の中で、整数、浮動小数点数、文字列のキーを混在させられます。
</p>

<p>
	配列を作成するには、値を <code>[key]</code> の文法で代入します。
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>func main() {
    a[0] = 0;
    print(a);
}</code></pre></div>
<!-- END-CODE -->

<p>
	配列の要素を削除するには、<code>remove()</code> を使います。
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>func main() {
    a[0] = 0;
    remove(a, 0);
    print(a);
}</code></pre></div>
<!-- END-CODE -->

<p>
	配列の要素数を取得するには、<code>size()</code> を使います。
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>func main() {
    a[0] = 0;
    print(size(a));
}</code></pre></div>
<!-- END-CODE -->

<h3>型変換</h3>
<p>
	整数から文字列:
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>s = "" + 123;</code></pre></div>
<!-- END-CODE -->

<p>
	浮動小数点数から文字列:
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>s = "" + 1.23;</code></pre></div>
<!-- END-CODE -->
<p>
	整数から浮動小数点数:
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>f = 0.0 + 123;</code></pre></div>
<!-- END-CODE -->

<p>
	文字列から整数:
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>i = 0 + "123";</code></pre></div>
<!-- END-CODE -->

<p>
	文字列から浮動小数点数:
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>f = 0.0 + "1.23";</code></pre></div>
<!-- END-CODE -->

<p>
	文法については以上です。
</p>

<h2>Suika2 エンジンの呼び出し</h2>
<p>
	Suika2 エンジンの本体は、エンジン操作のための関数を提供しています。<br>
	これらの関数は名前に <code>s2_</code> という接頭辞を持ちます。
</p>

<h3>フラグ用変数の値を取得する</h3>
<p>
	<code>s2_get_variable()</code> はフラグ用変数のインデックスを受け取り、フラグ用変数の値を返します。
</p>

<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>value = s2_get_variable(100);</code></pre></div>
<!-- END-CODE -->

<h3>フラグ用変数の値を設定する</h3>
<p>
	<code>s2_set_variable()</code> はフラグ用変数のインデックスと値を受け取って、フラグ用変数の値を変更します。
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>s2_set_variable(100, 1);</code></pre></div>
<!-- END-CODE -->

<h3>ランダムな数(乱数)を取得する</h3>
<p>
	<code>s2_random()</code> はランダムな整数を返します。戻り値の範囲は <code>0</code> から <code>99999</code> です。
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>value = s2_random();</code></pre></div>
<!-- END-CODE -->

<h3>コンフィグを書き換える</h3>
<p>
	<code>s2_set_config()</code> はコンフィグ名の文字列と、コンフィグ値の文字列を受け取り、コンフィグを書き換えます。<br>
	場合によっては、コンフィグの書き換えはただちに適用されませんので、<code>s2_reflect_*_config()</code> の呼び出しが必要になります。
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>// これらは即座に反映されます
s2_set_config("msgbox.x", "0");
s2_set_config("msgbox.speed", "20.0");

// この変更はただちには反映されません
s2_set_config("msgbox.bg.file", "msgbox-bg.png");</code></pre></div>
<!-- END-CODE -->

<h3>メッセージボックスと名前ボックスのアップデート</h3>
<p>
	<code>s2_reflect_msgbox_and_namebox_config()</code> は、
	メッセージボックスと名前ボックスに関するコンフィグの変更を実際に適用します。
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>s2_reflect_msgbox_and_namebox_config();</code></pre></div>
<!-- END-CODE -->

<h3>フォントのアップデート</h3>
<p>
	<code>s2_reflect_font_config()</code> は、フォントに関するコンフィグの変更を実際に適用します。
</p>
<!-- BEGIN-CODE -->
<div class="code-block"><pre><code>s2_reflect_font_config();</code></pre></div>
<!-- END-CODE -->


<!-- ----------- -->
		</div>
	</div>
</div>
<!-- END-CONTENT -->

<!-- BEGIN-EN-FOOTER -->
<footer id="footer" class="container-fluid nav-block bg-dark" data-bs-theme="dark">
  <div class="container">
		<div class="row">
			<div class="col-lg-6 col-md-12 mb-4 mb-md-0">
				<h5>Suika2 Visual Novel Game Engine</h5>
				<p>An open-source, cross-platform visual novel development suite.</p>
			</div>
			<div class="col-lg-6 col-md-12 mb-4 mb-md-0">
				<h5>Links</h5>
				<ul class="list-unstyled mb-0">
					<li><a href="https://github.com/suika2engine">GitHub</a></li>
				</ul>
			</div>
		</div>
	</div>
	<div class="text-center mt-5 ">
		Copyright &copy; 2023 Keiichi Tabata
		and <a href="https://github.com/suika2engine">the Suika2 Development Team</a>.
		All rights reserved.</div>
</footer>
<script src="/css/darkmode.js"></script>
<!-- END-EN-FOOTER -->

</body>
</html>
